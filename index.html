<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Turbo Tuga Campaign</title>
<style>
body { font-family: Arial, sans-serif; margin: 40px; background: #f4f6f8; }
h1 { color: #333; }
.box { background: #fff; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
button { padding: 8px 16px; margin: 5px; border: none; border-radius: 5px; background: #0070f3; color: white; cursor: pointer; }
button:hover { background: #005bb5; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
table, th, td { border: 1px solid #ddd; }
th, td { padding: 8px; text-align: center; }
</style>
</head>
<body>
<h1>Turbo Tuga ‚Äî Campaign Dashboard</h1>
<p>üéØ Goal: <strong>$1,000,000</strong> market cap</p>
<p>üê¢ $10,000 will be donated to turtle rescue projects if the goal is reached!</p>

<div class="box">
  <h2>1) Import JSON from SolScan</h2>
  <input type="file" id="jsonFile" accept=".json"/>
  <button onclick="loadJSON()">Load JSON</button>
</div>

<div class="box">
  <h2>2) Purchases & Tickets</h2>
  <button onclick="exportCSV()">üì• Export CSV</button>
  <table id="purchaseTable">
    <tr><th>Wallet</th><th>Amount (USD)</th><th>Tickets</th></tr>
  </table>
</div>

<div class="box">
  <h2>3) Draw Winners</h2>
  <button onclick="drawWinners()">üé≤ Draw 3 Winners</button>
  <ul id="winners"></ul>
</div>

<script>
let purchases = [];
let tickets = [];
const MIN_USD = 3;

function loadJSON() {
  const fileInput = document.getElementById("jsonFile");
  const file = fileInput.files[0];
  if(!file) return alert("Select a JSON file");

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      // Espera array de objetos: {wallet: "...", amount: 3.5}
      purchases = [];
      tickets = [];
      data.forEach(item => {
        if(item.wallet && item.amount >= MIN_USD) {
          const t = Math.floor(item.amount / MIN_USD);
          purchases.push({wallet: item.wallet, amount: item.amount, tickets: t});
          for(let i=0;i<t;i++) tickets.push(item.wallet);
        }
      });
      updateTable();
      alert(`Loaded ${purchases.length} purchases`);
    } catch(err) {
      alert("Invalid JSON format");
      console.error(err);
    }
  };
  reader.readAsText(file);
}

function updateTable() {
  const table = document.getElementById("purchaseTable");
  table.innerHTML = "<tr><th>Wallet</th><th>Amount (USD)</th><th>Tickets</th></tr>";
  purchases.forEach(p => {
    table.innerHTML += `<tr><td>${p.wallet}</td><td>$${p.amount.toFixed(2)}</td><td>${p.tickets}</td></tr>`;
  });
}

function drawWinners() {
  if(tickets.length===0) return alert("No tickets available!");
  let shuffled = [...tickets].sort(()=>0.5-Math.random());
  let selected = [...new Set(shuffled)].slice(0,3);
  document.getElementById("winners").innerHTML = selected.map(w=>`<li>${w}</li>`).join("");
}

function exportCSV() {
  if(purchases.length===0) return alert("No purchases to export!");
  let csv = "Wallet,Amount (USD),Tickets\n";
  purchases.forEach(p => { csv += `${p.wallet},${p.amount},${p.tickets}\n`; });
  let blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  let url = URL.createObjectURL(blob);
  let link = document.createElement("a");
  link.setAttribute("href", url);
  link.setAttribute("download", "purchases.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>
</body>
</html>
